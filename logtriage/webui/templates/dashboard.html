{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>Modules</h2>
  {% if modules %}
    <table style="width:100%; border-collapse:collapse; font-size:0.9rem;">
      <thead>
        <tr>
          <th style="text-align:left; padding:0.25rem;">Name</th>
          <th style="text-align:left; padding:0.25rem;">Mode</th>
          <th style="text-align:left; padding:0.25rem;">Path</th>
          <th style="text-align:left; padding:0.25rem;">Pipeline</th>
          <th style="text-align:left; padding:0.25rem;">Enabled</th>
          <th style="text-align:left; padding:0.25rem;">Last severity</th>
          <th style="text-align:left; padding:0.25rem;">Last seen</th>
          <th style="text-align:left; padding:0.25rem;">Last reason</th>
          <th style="text-align:left; padding:0.25rem;">24h errors</th>
          <th style="text-align:left; padding:0.25rem;">24h warnings</th>
          <th style="text-align:left; padding:0.25rem;">24h chunks</th>
        </tr>
      </thead>
      <tbody>
        {% for m in modules %}
        {% set st = stats.get(m.name) if stats else None %}
        {% set sev = st.last_severity if st else None %}
        <tr>
          <td style="padding:0.25rem;">{{ m.name }}</td>
          <td style="padding:0.25rem;">{{ m.mode }}</td>
          <td style="padding:0.25rem; font-family:monospace;">{{ m.path }}</td>
          <td style="padding:0.25rem;">{{ m.pipeline_name or "-" }}</td>
          <td style="padding:0.25rem;">{{ "yes" if m.enabled else "no" }}</td>
          <td style="padding:0.25rem;">
            {% if sev %}
              <span class="status-badge sev-{{ sev }}">{{ sev }}</span>
            {% else %}
              <span style="font-size:0.8rem; color:#888;">n/a</span>
            {% endif %}
          </td>
          <td style="padding:0.25rem; font-size:0.8rem;">
            {% if st and st.last_seen %}{{ st.last_seen }}{% else %}<span style="color:#888;">n/a</span>{% endif %}
          </td>
          <td style="padding:0.25rem; font-size:0.8rem; max-width:260px; overflow:hidden; text-overflow:ellipsis;">
            {% if st and st.last_reason %}{{ st.last_reason }}{% else %}<span style="color:#888;">n/a</span>{% endif %}
          </td>
          <td style="padding:0.25rem; text-align:right;">{{ st.errors_24h if st else 0 }}</td>
          <td style="padding:0.25rem; text-align:right;">{{ st.warnings_24h if st else 0 }}</td>
          <td style="padding:0.25rem; text-align:right;">{{ st.chunks_24h if st else 0 }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>No modules configured.</p>
  {% endif %}
</div>
{% endblock %}
